{% extends 'base.html' %}
{% load static %}
<!DOCTYPE html>
{% block content %}
<head>
    <!-- Include required libraries -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
</head>
<body>
    <div class="container-fluid">
        <!-- First Row -->
        <div class="row">
            <div class="col-md-6">
                <!-- Container for the dynamic dashboard -->
                <div id="symptom-chart"></div>
            </div>
            <div class="col-md-6">
                <div id="heatmap1"></div>
                
            </div>
        </div>

        <!-- Second Row -->
        <!-- <div class="row">
            <div class="col-md-12">
                <div id="dashboard-container"></div>
            </div>
        </div> -->
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            fetch('/selfqueue/export_data/')  // Replace with your export data endpoint
                .then(response => response.text())
                .then(data => {
                    // Parse the CSV data
                    const parsedData = Papa.parse(data, { header: true });
                    console.log(parsedData.data);
                    // Extract data for visualization (e.g., id and spot_number)
                    const xData = parsedData.data.map(entry => entry.id);
                    const yData = parsedData.data.map(entry => entry.spot_number);

                    // Create a Plotly chart
                    const trace = {
                        x: xData,
                        y: yData,
                        type: 'scatter',
                    };

                    const layout = {
                        title: 'Patient Queue Dashboard',
                        xaxis: { title: 'Patient ID' },
                        yaxis: { title: 'Spot Number' },
                    };

                    Plotly.newPlot('dashboard-container', [trace], layout);
                });
        });
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            fetch('/selfqueue/get_symptom_data/')  // Replace with the correct endpoint
                .then(response => response.json())
                .then(data => {
                    const symptoms = data.symptoms;
                    const frequencies = data.frequencies;
        
                    const trace = {
                        // x: symptoms,
                        // y: frequencies,
                        labels: symptoms,
                        labels: symptoms,
                        values: frequencies,
                        type: 'bar'
                    };
        
                    const layout = {
                        title: 'Symptom Frequency',
                        // xaxis: { title: 'Symptoms' },
                        // yaxis: { title: 'Frequency' }
                    };
        
                    Plotly.newPlot('symptom-chart', [trace], layout);
                });
        });
        </script>
        <div id="heatmap1"></div>
        <script>
            fetch('/selfqueue/patient_distribution_data/')
                .then(response => response.json())
                .then(data => {
                    const heatmapData = data.data;
                    const daysOfWeek = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
                    const hoursOfDay = Array.from({ length: 24 }, (_, i) => `${i}:00`);
    
                    const trace = {
                        x: daysOfWeek,
                        y: hoursOfDay,
                        z: heatmapData,
                        type: 'heatmap'
                    };
    
                    const layout = {
                        title: 'Patient Distribution',
                        xaxis: { title: 'Day of the Week' },
                        yaxis: { title: 'Hour of the Day' },
                        autosize: false
                    };
    
                    Plotly.newPlot('heatmap1', [trace], layout);
                });
        </script>
        
{% endblock %}
